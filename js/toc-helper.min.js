/*!
Date Sun Mar 03 2019 12:11:30 GMT+0800 (GMT+08:00) 
Version 1.0.0 
Copyright © 2018-2019 Design By xiaolang
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).TocHelper=e()}(this,function(){"use strict";var d=document,s=window,c=d.body,h=d.querySelector.bind(d),l=d.querySelectorAll.bind(d),t=/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent),i=t?"touchstart":"mouseenter",o=t?"touchend":"mouseleave",n=t?"touchend":"click",e="scroll",r=function(t){return t instanceof HTMLElement},f=function(t){return"string"==typeof t},p=function(t){return"[object Object]"===Object.prototype.toString.call(t)},u=function(t,e,i){if(t&&!i)return s.getComputedStyle(t).getPropertyValue(e);t.style[e]=i},a="toc",v="*[data-toc]",m={dom:v,classNames:{toc:a,fxied:"".concat(a,"-fixed"),brand:"".concat(a,"-brand"),navbar:"".concat(a,"-navbar"),hightlight:"".concat(a,"-hightlight"),nav:"".concat(a,"-nav"),link:"".concat(a,"-link"),active:"active",marginLeft1:"ml-1",marginLeft2:"ml-2",marginLeft3:"ml-3",marginLeft4:"ml-4",marginLeft5:"ml-5",marginLeft6:"ml-6"},hightlight:!0,brand:"目录",shadow:"shadow",idPrefix:"toc-heading-",offsetBody:c,topFixed:{top:24,left:0},maxDepth:6},g=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:m;return f(t)||r(t)?e.dom=t:p(t)&&(e=t),this.options=Object.assign({},m,e),this.megre(),this};g.prototype={megre:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(p(t)){if(this.options=Object.assign({},this.options,t),f(this.options.dom)&&(this.options.dom=h(this.options.dom)||h(v)),!this.options.dom||!r(this.options.dom))throw new Error("Not found any content, Please sure this dom is exist");var e;this.options.maxDepth=1<=(e=parseInt(this.options.maxDepth||6))&&e<=6?e:6;var i=this.options.offsetBody;if(i&&i!==c)if(r(i)){var s=u(i,"position");this.options.offsetBody=s&&"static"!==s?i:c}else if(f(i)){var o=function(t){try{return h(t)}catch(t){return null}}(i);if(o&&o!==c){var n=u(o,"position");this.options.offsetBody=n&&"static"!==n?o:c}else this.options.offsetBody=c}else this.options.offsetBody=c;else this.options.offsetBody=c;this.toc=h(this.options.dom.dataset.toc)||h(".".concat(this.options.classNames.toc));var a=this.toc&&this.toc.classList;return a&&!a.contains(this.options.classNames.toc)&&a.add(this.options.classNames.toc),this}},reload:function(){this.hightlight=!0===this.options.hightlight?h(".".concat(this.options.classNames.hightlight)):null,this.tocEvent(),this.fixed(),this.shadow(),!this.elements&&(this.elements=this.loadHeadings()),this.events=[this.offsetBodyScrollEvent.bind(this)],this.offsetBodyScrollDebounce(),this.setActive(h(".".concat(this.options.classNames.toc,' a[href="').concat(location.hash,'"]')))},offsetBodyScrollEvent:function(){this.scollToc.call(this)},addOffsetBodyScrollEvent:function(){(this.options.offsetBody===c?s:this.options.offsetBody).addEventListener(e,this.events[0])},removeOffsetBodyScrollEvent:function(){(this.options.offsetBody===c?s:this.options.offsetBody).removeEventListener(e,this.events[0])},offsetBodyScrollDebounce:function(){this.removeOffsetBodyScrollEvent(),this.debounce(this.addOffsetBodyScrollEvent,200).call(this)},reset:function(){this.clear();var t=d.createDocumentFragment(),e=this.elements=this.loadHeadings(),c=e.targets,i=e.levels;if("string"==typeof this.options.brand){var s=d.createElement("div");s.classList.add(this.options.classNames.brand),s.textContent=this.options.brand,t.appendChild(s)}var h=d.createElement("div");if(h.classList.add(this.options.classNames.navbar),t.appendChild(h),!0===this.options.hightlight){var o=d.createElement("div");o.classList.add(this.options.classNames.hightlight),h.appendChild(o)}var r=this.options.classNames.nav,l=null,f=1;i.forEach(function(t,e,i){var s=c[e];if(s)if(0===e||i[e-1]!==t){var o=d.createElement("nav");if(o.classList.add(r),o.appendChild(s),1===t)h.appendChild(o);else if(f<=t)l.appendChild(o);else{for(var n=l.parentNode,a=0;a<f-t-1;a++)n=n.parentNode;n&&n.appendChild(o)}l=o,f=t}else l.appendChild(s)}),this.toc.appendChild(t),this.reload()},scrollTop:function(){var t=this.options.offsetBody;return t===s?t.pageYOffset:t===c?d.documentElement.scrollTop||c.scrollTop:t.scrollTop},GID:function(){var t=0,e=this.options.idPrefix;return{next:function(){return t++,{value:"".concat(e).concat(t)}}}},debounce:function(i,s){return function(){var t=this,e=arguments;i.timer&&clearTimeout(i.timer),i.timer=setTimeout(function(){i.apply(t,e)},s)}},empty:function(t){if(t&&r(t))for(;t.lastChild;)t.removeChild(t.lastChild)},clear:function(){this.empty(this.toc),this.elements=null},scollToc:function(){var t=this.elements,e=t.offsets,i=t.targets,s=this.scrollTop(),o=e.findIndex(function(t){return Number(t)>s}),n=null;if(0===o)n=i[o];else if(0<o){var a=e[o-1],c=e[o],h=Math.abs((c-a)/4);s<h+a&&a<=s?n=i[o-1]:s<=c&&c-h<s&&(n=i[o])}n&&this.setActive(n)},loadHeadings:function(){var c=this,t=this.options.maxDepth,h=t,e=Array.from(this.options.dom.querySelectorAll(["h1","h2","h3","h4","h5","h6"].slice(0,t).join(","))||[]),r=this.GID();e.forEach(function(t,e,i){var s,o=function(t,i,e){if(e<=1||0===i)return 1;if(h<e)return h;for(var s=t.filter(function(t,e){return e<i}),o=s.length-1;0<=o;o--){var n=s[o][1],a=+s[o][3].nodeName[1];if(e<a)return n<e?n:e;if(e===a)return n;if(a<e)return n+1}}(i,e,+t.nodeName[1]),n=function t(e){var i=e.offsetTop;return e.offsetParent&&e.offsetParent!==c.options.offsetBody&&(i+=t(e.offsetParent)),i}(t);(s=t).id&&1===l("#".concat(s.id)).length||(s.id=r.next().value);var a=function(t,e){if(!t.textContent.replace(/\s/g,""))return!1;var i=c.toc.querySelector('a[href="#'.concat(t.id,'"]'));return i||((i=d.createElement("a")).href="#".concat(t.id),i.classList.add(c.options.classNames.link),2<=e&&i.classList.add("".concat(c.options.classNames["marginLeft".concat(e-1)])),i.textContent=t.textContent),i}(t,o);i.splice(e,1,[e,o,n,t,a])});var i=[],s=[],o=[],n=[];return e.forEach(function(t,e){i[e]=t[1],s[e]=t[2],o[e]=t[3],n[e]=t[4]}),{levels:i,offsets:s,sources:o,targets:n}},setHash:function(){var t=this.active?this.active.getAttribute("href"):null;t&&(location.hash=t)},setActive:function(t){var e=this.active,i=e?e.classList:[],s=this.options.classNames.active,o=".".concat(this.options.classNames.link,".").concat(this.options.classNames.active);e&&i.contains(s)&&i.remove(s),i=(e=this.active=t&&r(t)?t:h(o))&&(e.classList||[]),e&&!i.contains(s)&&i.add(s),this.setHightlight(e)},setHightlight:function(t){if(this.hightlight)if(t){var e=t.offsetTop,i=t.offsetHeight;this.hightlight.style.top=e+"px",this.hightlight.style.height=i+"px"}else this.hightlight.style.top=0,this.hightlight.style.height=0},__enter:function(t){this.setHightlight(t.target)},__leave:function(){this.setActive(this.active)},__click:function(t){this.offsetBodyScrollDebounce(),this.setActive(t.target)},tocEvent:function(){if(this.hightlight){var e=this;Array.from(l(".".concat(this.options.classNames.toc," .").concat(this.options.classNames.link))||[]).forEach(function(t){t.addEventListener(i,e.__enter.bind(e)),t.addEventListener(o,e.__leave.bind(e)),t.addEventListener(n,e.__click.bind(e))})}},shadow:function(){!1!==this.options.shadow&&this.toc&&!this.toc.classList.contains(this.options.shadow)&&this.toc.classList.add(this.options.shadow)},fixed:function(){var t=this.toc,e=this.options.topFixed;if(t){var i=this.options.classNames.fxied,s=t.classList;!1===e?(t.style.top="inherit",t.style.left="inherit",s.contains(i)&&s.remove(i)):(!s.contains(i)&&s.add(i),e.top&&(t.style.top=e.top+"px"),e.left&&(t.style.left=e.left+"px"))}}};var y=g,b=g;return y.default=b,y});
